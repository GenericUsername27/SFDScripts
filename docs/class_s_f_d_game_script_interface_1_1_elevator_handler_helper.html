<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>ElevatorHandlerHelper Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="SFDLogoAPI.png"/></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('class_s_f_d_game_script_interface_1_1_elevator_handler_helper.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="class_s_f_d_game_script_interface_1_1_elevator_handler_helper-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">ElevatorHandlerHelper Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Helper class to handle a single elevator instance with objects named with elevator prefix and floor suffix in the following pattern:<br />
 {elePrefix}_BtnUp - Button to make the elevator go up one floor.<br />
 {elePrefix}_BtnDown - Button to make the elevator go down one floor.<br />
 {elePrefix}_BtnFloor_{floorLetter} - Button to make the elevator go to the destinated PathJoint with the same floorLetter.<br />
 {elePrefix}_PathJoint_{floorLetter} - PathJoint per floor.<br />
 {elePrefix}_EleJoint - Elevator attachment joint.<br />
<br />
 
 <a href="class_s_f_d_game_script_interface_1_1_elevator_handler_helper.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a1bfe402e880b30646214c854cafef7e7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_s_f_d_game_script_interface_1_1_elevator_handler_helper.html#a1bfe402e880b30646214c854cafef7e7">ElevatorHandlerHelper</a> (<a class="el" href="class_s_f_d_game_script_interface_1_1_i_game.html">IGame</a> game, string elevatorPrefix, string[] elevatorFloorLetters, string startingFloorLetter)</td></tr>
<tr class="memdesc:a1bfe402e880b30646214c854cafef7e7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper class to handle a single elevator instance with objects named with elevator prefix and floor suffix in the following pattern:<br />
<br />
 <a href="#a1bfe402e880b30646214c854cafef7e7">More...</a><br /></td></tr>
<tr class="separator:a1bfe402e880b30646214c854cafef7e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aabd8398f8b3fcfe8e2e06c8c7c8d1ffc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_s_f_d_game_script_interface_1_1_elevator_handler_helper.html#aabd8398f8b3fcfe8e2e06c8c7c8d1ffc">ButtonPressed</a> (string btnPressedID)</td></tr>
<tr class="memdesc:aabd8398f8b3fcfe8e2e06c8c7c8d1ffc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle elevator button pressed  <a href="#aabd8398f8b3fcfe8e2e06c8c7c8d1ffc">More...</a><br /></td></tr>
<tr class="separator:aabd8398f8b3fcfe8e2e06c8c7c8d1ffc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42bd8248efb7e164e7350e72ea208af6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_s_f_d_game_script_interface_1_1_elevator_handler_helper.html#a42bd8248efb7e164e7350e72ea208af6">ElevatorArrived</a> (string floorPathJointID)</td></tr>
<tr class="memdesc:a42bd8248efb7e164e7350e72ea208af6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Will enable and disable correct buttons based on which floor the elevator arrived at  <a href="#a42bd8248efb7e164e7350e72ea208af6">More...</a><br /></td></tr>
<tr class="separator:a42bd8248efb7e164e7350e72ea208af6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Helper class to handle a single elevator instance with objects named with elevator prefix and floor suffix in the following pattern:<br />
 {elePrefix}_BtnUp - Button to make the elevator go up one floor.<br />
 {elePrefix}_BtnDown - Button to make the elevator go down one floor.<br />
 {elePrefix}_BtnFloor_{floorLetter} - Button to make the elevator go to the destinated PathJoint with the same floorLetter.<br />
 {elePrefix}_PathJoint_{floorLetter} - PathJoint per floor.<br />
 {elePrefix}_EleJoint - Elevator attachment joint.<br />
<br />
</p>
<p>This helper class was based on the following SFD Script code and can be modified if you like for your own script:<br />
 See official maps for examples how to use this helper class. </p><pre class="fragment">*/
/*
 public class ElevatorHandlerHelper
 {
    
    private class ElevatorFloor
    {
        public IObjectTrigger FloorButton = null;
        public IObjectElevatorPathJoint ElevatorPathJoint = null;
        public string FloorLetter = "";
    }

    private IGame Game;
    private IObjectElevatorAttachmentJoint ElevatorAttachmentJoint = null;
    private IObjectTrigger ElevatorButtonUp = null;
    private IObjectTrigger ElevatorButtonDown = null;
    private string ElevatorCurrentFloorLetter = "";
    private float ElevatorMotorSpeed = 0f;

    private List&lt;ElevatorFloor&gt; ElevatorFloors = null;

    /// &lt;param name="elevatorPrefix"&gt;Prefix for the elevator&lt;/param&gt;
    /// &lt;param name="elevatorFloorLetters"&gt;Floors starting from bottom to top in order&lt;/param&gt;
    /// &lt;param name="startingFloorLetter"&gt;Starting floor the elevator attachment joint spawns at&lt;/param&gt;
    public ElevatorHandlerHelper(IGame game, string elevatorPrefix, string[] elevatorFloorLetters, string startingFloorLetter)
    {
        // prepare data
        this.Game = game;
        this.ElevatorFloors = new List&lt;ElevatorFloor&gt;();

        // fetch objects
        if (elevatorFloorLetters != null)
        {
            foreach (string floorLetter in elevatorFloorLetters)
            {
                IObject[] floorButton = Game.GetObjectsByCustomID(string.Format("{0}_BtnFloor_{1}", elevatorPrefix, floorLetter));
                IObject[] pathJoint = Game.GetObjectsByCustomID(string.Format("{0}_PathJoint_{1}", elevatorPrefix, floorLetter));
                ElevatorFloor floor = new ElevatorFloor();
                floor.FloorLetter = floorLetter;
                // should only be one button and one pathJoint per floor
                floor.FloorButton = (floorButton.Length &gt;= 1 &amp;&amp; floorButton[0] is IObjectTrigger) ? (IObjectTrigger)floorButton[0] : null;
                floor.ElevatorPathJoint = (pathJoint.Length &gt;= 1 &amp;&amp; pathJoint[0] is IObjectElevatorPathJoint) ? (IObjectElevatorPathJoint)pathJoint[0] : null;
                this.ElevatorFloors.Add(floor);
            }
        }

        // should only be one elevatorAttachmentJoint
        IObject[] elevatorAttachmentJoint = Game.GetObjectsByCustomID(string.Format("{0}_EleJoint", elevatorPrefix));
        if ((elevatorAttachmentJoint.Length == 1) &amp;&amp; (elevatorAttachmentJoint[0] is IObjectElevatorAttachmentJoint))
        {
            this.ElevatorAttachmentJoint = (IObjectElevatorAttachmentJoint)elevatorAttachmentJoint[0];
            this.ElevatorMotorSpeed = ElevatorAttachmentJoint.GetMotorSpeed(); // store motorspeed set in the editor
        }
        else
        {
            Game.WriteToConsole(string.Format("Can't find ElevatorAttachmentJoint '{0}_EleJoint'", elevatorPrefix));
        }

        //{elePrefix}_BtnUp
        //{elePrefix}_BtnDown
        IObject[] buttonUp = Game.GetObjectsByCustomID(string.Format("{0}_BtnUp", elevatorPrefix));
        IObject[] buttonDown = Game.GetObjectsByCustomID(string.Format("{0}_BtnDown", elevatorPrefix));
        this.ElevatorButtonUp = (buttonUp.Length &gt;= 1 &amp;&amp; buttonUp[0] is IObjectTrigger) ? (IObjectTrigger)buttonUp[0] : null;
        this.ElevatorButtonDown = (buttonDown.Length &gt;= 1 &amp;&amp; buttonDown[0] is IObjectTrigger) ? (IObjectTrigger)buttonDown[0] : null;

        // start with negative speed to make elevator reset itself to its starting position
        if ((this.ElevatorAttachmentJoint != null) &amp;&amp; (this.ElevatorAttachmentJoint.GetMotorSpeed() &lt; 0f))
        {
            this.ElevatorAttachmentJoint.SetMotorSpeed(-this.ElevatorAttachmentJoint.GetMotorSpeed());
        }

        Game.WriteToConsole("Elevator Initialized");
    }
    
    /// Handle elevator button pressed event
    public void ButtonPressed(string btnPressedID)
    {
        if (this.ElevatorAttachmentJoint != null)
        {
            ElevatorFloor destinationElevatorFloor = GetElevatorFloorByButtonID(btnPressedID);
            if (destinationElevatorFloor != null)
            {
                // Check that the button pressed belong to another floor. In that case move the elevator to that floor and disable buttons.
                if (this.ElevatorCurrentFloorLetter != destinationElevatorFloor.FloorLetter)
                {
                    if (destinationElevatorFloor.ElevatorPathJoint != null) // failsafe
                    {
                        ElevatorFloor currentElevatorFloor = GetElevatorFloorByFloorLetter(this.ElevatorCurrentFloorLetter);
                        if (currentElevatorFloor != null) // failsafe
                        {
                            if ((currentElevatorFloor.ElevatorPathJoint != null) &amp;&amp; (destinationElevatorFloor.ElevatorPathJoint != null)) // failsafe
                            {
                                // Clear destination's next PathJoint so the elevator will stop there and not automatically continue it's path
                                for (int i = 0; i &lt; ElevatorFloors.Count; i++)
                                {
                                    if (ElevatorFloors[i].ElevatorPathJoint != null)
                                    {
                                        ElevatorFloors[i].ElevatorPathJoint.SetNextPathJoint(null);
                                    }
                                }
                                // Set up path-joints connection
                                currentElevatorFloor.ElevatorPathJoint.SetNextPathJoint(destinationElevatorFloor.ElevatorPathJoint);
                                // Re-initialize elevatorAttachmentJoint
                                this.ElevatorAttachmentJoint.SetElevatorPathJoint(currentElevatorFloor.ElevatorPathJoint);
                                this.ElevatorAttachmentJoint.SetMotorSpeed(this.ElevatorMotorSpeed);
                                // Disable buttons
                                ButtonsSetEnabled(false);
                            }
                        }
                    }
                }
            }
        }
    }

    /// Handle elevator arrived event
    public void ElevatorArrived(string floorPathJointID)
    {
        if (this.ElevatorAttachmentJoint != null)
        {
            ElevatorFloor elevatorFloor = GetElevatorFloorByPathJointID(floorPathJointID);
            if (elevatorFloor != null)
            {
                this.ElevatorCurrentFloorLetter = elevatorFloor.FloorLetter;
                // Play sound
                Game.PlaySound("ElevatorDing", ElevatorAttachmentJoint.GetWorldPosition(), 1f);
                // Enable buttons
                ButtonsSetEnabled(true);
            }
            else
            {
                Game.WriteToConsole(string.Format("ElevatorArrived ({0}) - PathJointNotFound", floorPathJointID));
            }
        }
    }

    private void ButtonsSetEnabled(bool value)
    {
        // Enable buttons
        for (int i = 0; i &lt; this.ElevatorFloors.Count; i++)
        {
            if (this.ElevatorFloors[i].FloorButton != null)
            {
                this.ElevatorFloors[i].FloorButton.SetEnabled(value);
            }
        }
        if (this.ElevatorButtonUp != null)
        {
            this.ElevatorButtonUp.SetEnabled(value);
        }
        if (this.ElevatorButtonDown != null)
        {
            this.ElevatorButtonDown.SetEnabled(value);
        }
    }

    private ElevatorFloor GetElevatorFloorByPathJointID(string floorPathJointID)
    {
        for (int i = 0; i &lt; this.ElevatorFloors.Count; i++)
        {
            if ((this.ElevatorFloors[i].ElevatorPathJoint != null) &amp;&amp; (this.ElevatorFloors[i].ElevatorPathJoint.CustomID == floorPathJointID))
            {
                return this.ElevatorFloors[i];
            }
        }
        return null;
    }

    private ElevatorFloor GetElevatorFloorByButtonID(string buttonID)
    {
        for (int i = 0; i &lt; this.ElevatorFloors.Count; i++)
        {
            if ((this.ElevatorFloors[i].FloorButton != null) &amp;&amp; (this.ElevatorFloors[i].FloorButton.CustomID == buttonID))
            {
                return this.ElevatorFloors[i];
            }
        }
        // Check if buttonUp or buttonDown has been pressed aswell and find out the next ElevatorFloor based on that
        if ((this.ElevatorButtonDown != null) &amp;&amp; (this.ElevatorButtonDown.CustomID == buttonID))
        {
            // Floors starting from bottom to top in order
            for (int i = 1; i &lt; this.ElevatorFloors.Count; i++)
            {
                if (this.ElevatorFloors[i].FloorLetter == this.ElevatorCurrentFloorLetter)
                {
                    return this.ElevatorFloors[i - 1];
                }
            }
        }
        if ((this.ElevatorButtonUp != null) &amp;&amp; (this.ElevatorButtonUp.CustomID == buttonID))
        {
            // Floors starting from bottom to top in order
            for (int i = 0; i &lt; this.ElevatorFloors.Count - 1; i++)
            {
                if (this.ElevatorFloors[i].FloorLetter == this.ElevatorCurrentFloorLetter)
                {
                    return this.ElevatorFloors[i + 1];
                }
            }
        }

        return null;
    }

    private ElevatorFloor GetElevatorFloorByFloorLetter(string floorLetter)
    {
        for (int i = 0; i &lt; this.ElevatorFloors.Count; i++)
        {
            if (this.ElevatorFloors[i].FloorLetter == floorLetter)
            {
                return this.ElevatorFloors[i];
            }
        }
        return null;
    }

 }
*/
/**</pre> </div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a1bfe402e880b30646214c854cafef7e7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_s_f_d_game_script_interface_1_1_elevator_handler_helper.html">ElevatorHandlerHelper</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_s_f_d_game_script_interface_1_1_i_game.html">IGame</a>&#160;</td>
          <td class="paramname"><em>game</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>elevatorPrefix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string[]&#160;</td>
          <td class="paramname"><em>elevatorFloorLetters</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>startingFloorLetter</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Helper class to handle a single elevator instance with objects named with elevator prefix and floor suffix in the following pattern:<br />
<br />
</p>
<p>{elePrefix}_BtnUp - Button to make the elevator go up one floor.<br />
{elePrefix}_BtnDown - Button to make the elevator go down one floor.<br />
{elePrefix}_BtnFloor_{floorLetter} - Button to make the elevator go to the destinated PathJoint with the same floorLetter.<br />
{elePrefix}_PathJoint_{floorLetter} - PathJoint per floor.<br />
{elePrefix}_EleJoint - Elevator attachment joint.<br />
 </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">game</td><td></td></tr>
    <tr><td class="paramname">elevatorPrefix</td><td>Prefix for the elevator</td></tr>
    <tr><td class="paramname">elevatorFloorLetters</td><td>Floors starting from bottom to top in order</td></tr>
    <tr><td class="paramname">startingFloorLetter</td><td>Starting floor the elevator attachment joint spawns at</td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="aabd8398f8b3fcfe8e2e06c8c7c8d1ffc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ButtonPressed </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>btnPressedID</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handle elevator button pressed </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">btnPressedID</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a42bd8248efb7e164e7350e72ea208af6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ElevatorArrived </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>floorPathJointID</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Will enable and disable correct buttons based on which floor the elevator arrived at </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">floorPathJointID</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespace_s_f_d_game_script_interface.html">SFDGameScriptInterface</a></li><li class="navelem"><a class="el" href="class_s_f_d_game_script_interface_1_1_elevator_handler_helper.html">ElevatorHandlerHelper</a></li>
    <li class="footer">Generated on Sun Jun 4 2017 14:39:23 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
